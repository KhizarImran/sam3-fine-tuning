# @package _global_
defaults:
  - roboflow_v100/roboflow_v100_full_ft_100_images
  - _self_

# Override paths for fuse cutout dataset
paths:
  roboflow_vl_100_root: "sam3_datasets"
  experiment_log_dir: "experiments/fuse_cutout"
  bpe_path: "sam3/sam3/assets/bpe_simple_vocab_16e6.txt.gz"

# Override dataset configuration
roboflow_train:
  num_images: null  # Use all available images (we have 3 training images)
  supercategory: "fuse-cutout"  # Our dataset name

# Override launcher settings for single GPU
launcher:
  num_nodes: 1
  gpus_per_node: 1

# Override training hyperparameters
scratch:
  max_epochs: 30
  batch_size: 1
  resolution: 1008  # Keep original resolution for RoPE compatibility
  num_train_workers: 0  # No workers to save memory
  num_val_workers: 0  # No workers for validation
  max_ann_per_img: 50  # Reduced from 200 to save memory

# Seed for reproducibility
seed: 42

# Override validation dataset to use 'valid' instead of 'test'
trainer:
  skip_first_val: true  # Skip validation on first epoch to save memory
  val_epoch_freq: 10  # Validate every 10 epochs instead of every epoch
  skip_saving_ckpts: false  # Enable checkpoint saving

# Override checkpoint settings to save model
checkpoint:
  save_dir: ${paths.experiment_log_dir}/checkpoints
  save_freq: 5  # Save every 5 epochs
  data:
    val:
      dataset:
        img_folder: ${paths.roboflow_vl_100_root}/${roboflow_train.supercategory}/valid/
        ann_file: ${paths.roboflow_vl_100_root}/${roboflow_train.supercategory}/valid/_annotations.coco.json

  # Override validation evaluator to use 'valid' instead of 'test'
  meters:
    val:
      roboflow100:
        detection:
          pred_file_evaluators:
            - _target_: sam3.eval.coco_eval_offline.CocoEvaluatorOfflineWithPredFileEvaluators
              gt_path: ${paths.roboflow_vl_100_root}/${roboflow_train.supercategory}/valid/_annotations.coco.json
              tide: False
              iou_type: "bbox"
